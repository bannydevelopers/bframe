<?php if(isset($msg)){?>
<p class="msg content rounded box-shadow" onclick="this.parentNode.removeChild(this)"><?=$msg?></p>
<?php }?>
<h1 class="flex">
    <span>Classes management</span>
    <button class="flex-shrink round" onclick="add_class()">ADD CLASS</button>&nbsp;
    <button class="flex-shrink round" onclick="add_section()">ADD SECTION</button>
</h1>
<div class="tab-view">
    <input type="radio" name="tab" id="class_tab1" checked><label for="class_tab1">Classes</label>
    <input type="radio" name="tab" id="class_tab2"><label for="class_tab2">Sections</label>
    <div class="tab-panes">
        <div class="white">
            <?php if($classes){?>
            <div class="flex cards">
                <?php foreach($classes as $cl){ $cs  = json_decode($cl['class_subjects']);?>
                <div class="content-small rounded">
                    <div class="content-small" style="display: flex;">
                        <strong style="flex-grow: 1;"><?=$cl['class_name']?></strong>
                        <a onclick="delete_class(`<?=$cl['class_id']?>`)" data-icon="&#xf2ed;"></a>
                    </div><hr>
                    <strong class="content-small">Subjects</strong>
                    <ul>
                        <?php foreach($subjects as $sb){if(!$cs or !in_array($sb['subject_id'], $cs)) continue;?>
                        <li class="content-small" data-icon="&#xf560;"><?=$sb['subject_name']?></li>
                        <?php }?>
                        </ul>
                </div>
                <?php }?>
            </div>
            <?php }else{?>
            <div class="large-text-3x center" style="margin-top: 2em;">
                <p class="large-text-3x"><span data-icon="&#xf071;" style="color: #FFCB3D;"></span></p>
                <p class="content">No class registered yet!</p>
                <p style="font-size: 16px;">
                    <em>If you registered a class for other school, won't appear here</em>
                </p>
            </div>
            <?php }?>
        </div>
        <div class="white">
            <?php if($sections){?>
            <div class="flex cards">
                <?php foreach($sections as $se){?>
                <div class="content-small rounded">
                    <div class="content-small" style="display: flex;">
                        <strong style="flex-grow: 1;"><?=$se['section_name']?></strong>
                    </div>
                    <div style="text-align: right;">
                        <a onclick="delete_section(`<?=$se['section_id']?>`)" data-icon="&#xf2ed;"></a>
                    </div>
                </div>
                <?php }?>
            </div>
            <?php }else{?>
            <div class="large-text-3x center" style="margin-top: 2em;">
                <p class="large-text-3x"><span data-icon="&#xf071;" style="color: #FFCB3D;"></span></p>
                <p class="content">No section registered!</p>
                <p style="font-size: 16px;">
                    <em>You may not need any, if your every class do not span multiple rooms</em>
                </p>
            </div>
            <?php }?>
        </div>
    </div>
</div>
<template>
    <?php include __DIR__.'/class_add.html';?>
    <form method="post" class="content">
        <label>Section name</label>
        <input type="text" name="section_name" placeholder="Section name...">
        <div style="text-align: right;" class="content">
            <button>Save</button>
        </div>
    </form>
</template>
<script>
    const add_class = ()=>{
        let htf = document.querySelector('template').content.cloneNode(true).children[0];
        Swal.fire({
            title: 'Add class',
            html:htf,
            customClass:'mySwal',
            showConfirmButton:false
        });
    };
    const add_section = ()=>{
        let htf = document.querySelector('template').content.cloneNode(true).children[1];
        Swal.fire({
            title: 'Add section',
            html:htf,
            customClass:'mySwal',
            showConfirmButton:false
        });
    };
    const delete_section = id=>{
        let elem = window.event.target;
        Swal.fire({
            title:'Surely delete this section?',
            icon: 'question'
        })
        .then(prompt=>{
            if(prompt.isConfirmed){
                let fd = new FormData();
                fd.append('delete_section', id);
                fd.append('ajax_request', 1);
                ajax(
                    window.location.href,
                    resp=>{
                        if(resp == 'ok'){
                            Swal.fire({
                                title:'Section deleted successful!',
                                icon:'success'
                            })
                            .then(val=>{
                                elem.parentNode.parentNode.parentNode.removeChild(elem.parentNode.parentNode);
                            });
                        }
                        else{
                            Swal.fire({
                                icon:'error',
                                html: resp
                            });
                        }
                    },
                    error=>{
                        console.log(error);
                    },
                    fd
                );
            }
        });
    }
    const delete_class = id=>{
        let elem = window.event.target;
        Swal.fire({
            title:'Surely delete this class?',
            icon: 'question'
        })
        .then(prompt=>{
            if(prompt.isConfirmed){
                let fd = new FormData();
                fd.append('delete_class', id);
                fd.append('ajax_request', 1);
                ajax(
                    window.location.href,
                    resp=>{
                        if(resp == 'ok'){
                            Swal.fire({
                                title:'Class deleted successful!',
                                icon:'success'
                            })
                            .then(val=>{
                                elem.parentNode.parentNode.parentNode.removeChild(elem.parentNode.parentNode);
                            });
                        }
                        else{
                            Swal.fire({
                                icon:'error',
                                html: resp
                            });
                        }
                    },
                    error=>{
                        console.log(error);
                    },
                    fd
                );
            }
        });
    }
</script>