<?php if(isset($msg)){?>
<p class="msg content rounded box-shadow" onclick="this.parentNode.removeChild(this)"><?=$msg?></p>
<?php }?>
<h1 class="flex content-small">
    <span>Assignments</span>
    <button class="flex-shrink round" onclick="add_assignment()">ADD ASSIGNMENT</button>
</h1>
<div class="white content-small">
    <div class="flex cards">
        <?php foreach($assignments as $cl){?>
        <div class="rounded">
            <div class="content grey">
                <strong><?=$cl['assignment_title']?></strong>
            </div>
            <div class="content-small">
                <div class="content-small">
                    <?=$cl['subject_name']?>,&nbsp;<?=$cl['class_name']?>,&nbsp;<?=$cl['section_name']?>
                </div>
                <div class="content-small">
                    <strong>Start: </strong>&nbsp;<?=system::format_time($cl['assigment_date'])?>
                </div>
                <div class="content-small">
                    <strong>End: </strong>&nbsp;<?=system::format_time($cl['assignment_submission_date'])?>
                </div>
            </div>
            <div class="content-small" style="border-top: 1px solid #eee;">
                <div style="text-align: right;">
                    <a class="content-small" onclick="view_assignment()" data-icon="&#xf06e;"></a>
                    <a class="content-small" onclick="delete_assignment(`<?=$cl['assignment_id']?>`)" data-icon="&#xf2ed;"></a>
                </div>
                <div style="display: none;">
                    <iframe src="<?=$cl['assignment_content']?>" width="100%" style="min-height:80vh"></iframe>
                </div>
            </div>
        </div>
        <?php }?>
    </div>
</div>
<template>
    <?php include __DIR__.'/assignments_add.html';?>
</template>
<script>
    var tinymce_toolbar = 'save | undo redo | bold italic underline strikethrough | fontselect | fontsizeselect '
                            +'| formatselect | alignleft aligncenter alignright alignjustify | outdent indent '
                            +'|  numlist bullist table | image media link | ltr rtl '
                            +'| charmap emoticons fullscreen code';
    const add_assignment = ()=>{
        let htf = document.querySelector('template').content.cloneNode(true).children[0];
        Swal.fire({
            title: 'Add assignment',
            html:htf,
            customClass:'mySwal',
            showConfirmButton:false
        });
        setTimeout(()=>{
            tinymce.init({selector: 'textarea.tinymce', menubar: '', plugins: "code", toolbar:tinymce_toolbar});
        },300);
        
        document.querySelector('.mySwal [type=reset]').addEventListener('click', evt=>{Swal.close()});
    };
    const view_assignment = stitle=>{
        let sbody = window.event.target.parentNode.nextElementSibling.innerHTML;
        Swal.fire(
            {
                title: stitle,
                html: sbody,
                customClass: 'wideSwal'
            }
        );
    }
    const delete_assignment = id=>{
    let elem = window.event.target.parentNode.parentNode.parentNode;
    Swal.fire({
        title:'Surely delete this assignment?',
        icon: 'question'
    })
    .then(prompt=>{
        if(prompt.isConfirmed){
            let fd = new FormData();
            fd.append('delete_assignment', id);
            fd.append('ajax_request', 1);
            ajax(
                window.location.href,
                resp=>{
                    if(resp == 'ok'){
                        Swal.fire({
                            title:'Assignment deleted successful!',
                            icon:'success'
                        })
                        .then(val=>{
                            elem.parentNode.removeChild(elem);
                            console.log(elem);
                        });
                    }
                    else{
                        Swal.fire({
                            icon:'error',
                            html: resp
                        });
                    }
                },
                error=>{
                    console.log(error);
                },
                fd
            );
        }
    });
}
</script>