<?php if(isset($msg)){?>
<p class="msg content rounded box-shadow" onclick="this.parentNode.removeChild(this)"><?=$msg?></p>
<?php }?>
<h1>
    <span>Examinations</span>
</h1>
<div class="tab-view">
    <input type="radio" name="tab" id="class_tab1" checked><label for="class_tab1">Examinations</label>
    <input type="radio" name="tab" id="class_tab2"><label for="class_tab2">Exam. schedule</label>
    <input type="radio" name="tab" id="class_tab3"><label for="class_tab3">Mark sheet</label>
    <input type="radio" name="tab" id="class_tab4"><label for="class_tab4">Results</label>
    <input type="radio" name="tab" id="class_tab5"><label for="class_tab5">Configuration</label>
    <div class="tab-panes">
        <div class="white">
            <!--pre><?php print_r($exams)?></pre-->
            <div class="contentx" style="text-align: right;">
                <button onclick="add_grade()">ADD GRADE</button>
            </div>
            <br>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Notes</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <?php $i = 0; foreach($exams as $exam){?>
                    <tr>
                        <td><?=++$i?></td>
                        <td><?=$exam['exam']?></td>
                        <td><?=$exam['date']?></td>
                        <td><?=$exam['note']?></td>
                        <td>
                            <a onclick="edit_grade" data-icon="&#xf044;">Edit&nbsp;</a>&nbsp;&nbsp;
                            <a onclick="delete_grade" data-icon="&#xf1f8;">Delete</a>
                        </td>
                    </tr>
                    <?php }?>
                </tbody>
            </table>
        </div>
        <div class="white">
            Exam schedule...
        </div>
        <div class="white">
            <div class="flex">
                <div>
                    <label>Class</label>
                    <select>
                        <option>Choose...</option>
                        <?php foreach($classes as $cl){?>
                        <option value="<?=$cl['class_id']?>"><?=$cl['class_name']?></option>
                        <?php }?>
                    </select>
                </div>
                <div>
                    <label>Section</label>
                    <select>
                        <option>Choose...</option>
                        <?php foreach($sections as $cl){?>
                        <option value="<?=$cl['section_id']?>"><?=$cl['section_name']?></option>
                        <?php }?>
                    </select>
                </div>
                <div>
                    <label>Exam</label>
                    <select>
                        <option>Choose...</option>
                        <?php foreach($exams as $cl){?>
                        <option value="<?=$cl['examID']?>"><?=$cl['exam']?></option>
                        <?php }?>
                    </select>
                </div>
                <div>
                    <label>Subject</label>
                    <select>
                        <option>Choose...</option>
                    </select>
                </div>
            </div>
            <br>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="white">
            Results...
        </div>
        <div class="white">
            <div class="contentx" style="text-align: right;">
                <button onclick="add_grade()">ADD GRADE</button>
            </div>
            <br>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Grade point</th>
                        <th>Minimum value</th>
                        <th>Maximum value</th>
                        <th>Notes</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <?php $i = 0; foreach($grades as $gr){?>
                    <tr>
                        <td><?=++$i?></td>
                        <td><?=$gr['grade_name']?></td>
                        <td><?=$gr['grade_point']?></td>
                        <td><?=$gr['grade_min']?></td>
                        <td><?=$gr['grade_max']?></td>
                        <td><?=$gr['grade_notes']?></td>
                        <td>
                            <a onclick="edit_grade" data-icon="&#xf044;">Edit&nbsp;</a>&nbsp;&nbsp;
                            <a onclick="delete_grade" data-icon="&#xf1f8;">Delete</a>
                        </td>
                    </tr>
                    <?php }?>
                </tbody>
            </table>
        </div>
    </div>
</div>
<template>
    <?php include __DIR__.'/class_add.html';?>
    <form method="post" class="content">
        <label>Section name</label>
        <input type="text" name="section_name" placeholder="Section name...">
        <div style="text-align: right;" class="content">
            <button>Save</button>
        </div>
    </form>
    <form method="post" class="content" style="overflow: auto;">
        <div class="flex">
            <div class='form-group' >                        <label for="grade" class="col-sm-2 control-label">
                    Grade Name <span class="text-red">*</span>
                </label>
                <div class="col-sm-6">
                    <input type="text" class="form-control" id="grade" name="grade" value="" >
                </div>
            </div>

            <div class='form-group' >                        <label for="point" class="col-sm-2 control-label">
                    Grade Point <span class="text-red">*</span>
                </label>
                <div class="col-sm-6">
                    <input type="text" class="form-control" id="point" name="point" value="" >
                </div>
            </div>
        </div>
        <div class="flex">
            <div>
                <div class='form-group' >
                    <label for="gradefrom"> Minimum value <span class="text-red">*</span></label>
                    <div class="col-sm-6">
                        <input type="text" class="form-control" id="gradefrom" name="gradefrom" value="" >
                    </div>
                </div>

                <div class='form-group' >
                    <label for="gradeupto" class="col-sm-2 control-label">Maximum value <span class="text-red">*</span></label>
                    <div class="col-sm-6">
                        <input type="text" class="form-control" id="gradeupto" name="gradeupto" value="" >
                    </div>
                </div>
            </div>
            <div class='form-group' >                        
                <label for="note" class="col-sm-2 control-label">Note</label>
                <textarea rows="7" class="form-control" id="note" name="note"></textarea>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-8">
                <button onclick="Swal.close()" type="button">Close</button>
                <button type="submit">Add Grade</button>
            </div>
        </div>
    </form>
</template>
<script>
    const add_class = ()=>{
        let htf = document.querySelector('template').content.cloneNode(true).children[0];
        Swal.fire({
            title: 'Add class',
            html:htf,
            customClass:'mySwal',
            showConfirmButton:false
        });
    };
    const add_section = ()=>{
        let htf = document.querySelector('template').content.cloneNode(true).children[1];
        Swal.fire({
            title: 'Add section',
            html:htf,
            customClass:'mySwal',
            showConfirmButton:false
        });
    };
    const delete_section = id=>{
        let elem = window.event.target;
        Swal.fire({
            title:'Surely delete this section?',
            icon: 'question'
        })
        .then(prompt=>{
            if(prompt.isConfirmed){
                let fd = new FormData();
                fd.append('delete_section', id);
                fd.append('ajax_request', 1);
                ajax(
                    window.location.href,
                    resp=>{
                        if(resp == 'ok'){
                            Swal.fire({
                                title:'Section deleted successful!',
                                icon:'success'
                            })
                            .then(val=>{
                                elem.parentNode.parentNode.parentNode.removeChild(elem.parentNode.parentNode);
                            });
                        }
                        else{
                            Swal.fire({
                                icon:'error',
                                html: resp
                            });
                        }
                    },
                    error=>{
                        console.log(error);
                    },
                    fd
                );
            }
        });
    }
    const delete_class = id=>{
        let elem = window.event.target;
        Swal.fire({
            title:'Surely delete this class?',
            icon: 'question'
        })
        .then(prompt=>{
            if(prompt.isConfirmed){
                let fd = new FormData();
                fd.append('delete_class', id);
                fd.append('ajax_request', 1);
                ajax(
                    window.location.href,
                    resp=>{
                        if(resp == 'ok'){
                            Swal.fire({
                                title:'Class deleted successful!',
                                icon:'success'
                            })
                            .then(val=>{
                                elem.parentNode.parentNode.parentNode.removeChild(elem.parentNode.parentNode);
                            });
                        }
                        else{
                            Swal.fire({
                                icon:'error',
                                html: resp
                            });
                        }
                    },
                    error=>{
                        console.log(error);
                    },
                    fd
                );
            }
        });
    }
    const add_grade = ()=>{
        let htf = document.querySelector('template').content.cloneNode(true).children[2];
        Swal.fire({
            title: 'Add grade',
            html:htf,
            customClass:'mySwal',
            showConfirmButton:false
        });
        let frm = document.querySelector('.mySwal form');
        frm.addEventListener('submit', evt=>{
            evt.preventDefault();
            Swal.fire({
                title: 'Submiting...',
                icon:'info'
            });
        });
    }
</script>