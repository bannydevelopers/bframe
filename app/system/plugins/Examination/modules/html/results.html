<?php if(isset($msg)){?>
    <p class="msg content rounded box-shadow" onclick="this.parentNode.removeChild(this)"><?=$msg?></p>
    <?php }?>
    <h1 class="content-small flex">
        <span>Exam results</span>
        <button class="flex-shrink" onclick="create_result()">Create result group</button>
    </h1>
    <div class="content-small">
        <div class="flex content-small box-shadow">
            <select onchange="update_result(true)">
                <option value="">Class...</option>
                <?php foreach($class as $ex){?>
                <option value="<?=$ex['class_id']?>">
                    <?=$ex['class_name']?>
                </option>
                <?php }?>
            </select>
            <select onchange="update_result(true)">
                <option value="">Section...</option>
                <?php foreach($section as $ex){?>
                <option value="<?=$ex['section_id']?>">
                    <?=$ex['section_name']?>
                </option>
                <?php }?>
            </select>
        </div>
    </div>
    <div class="content-small">
        <div class="white view-pane">
            <div style="text-align: center;">
                <span style="font-size: 18vw;margin-left: .3em;" data-icon="&#xf071;"></span><br>
                <em class="content">Make selection to continue</em>
            </div>
        </div>
    </div>
    <template>
        <?php include __DIR__.'/create_results.html';?>
    </template>
    <script>
        let bak, timer_run;
        const update_result = delay => {
            let vp = document.querySelector('.view-pane'),
                optval = window.event.target.parentNode.children[0];
            if(!bak) bak = vp.innerHTML;
            if(timer_run) clearTimeout(timer_run);
            if(optval.value == '') {
                return;
            }
            function exec_update(){
                let elems = window.event.target.parentNode.querySelectorAll('select');

                if(elems[0].value == '' || elems[1].value == '') return;
                vp.innerHTML = '<h1 class="content center">Loading...</h1>';
                let fd = new FormData();
                fd.append('fetch_results', 1);
                fd.append('class', elems[0].value);
                fd.append('section', elems[1].value);
                ajax(
                    window.location.href,
                    response=>{
                        vp.innerHTML = response;
                    },
                    error=>{
                        Swal.fire({
                            icon:'info',
                            html: error
                        });
                    },
                    fd
                );
            }
            /*if(delay){
                timer_run = setTimeout(exec_update, 2000);
            }
            else */exec_update();
        };
    </script>