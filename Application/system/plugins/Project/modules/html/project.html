<div class="d-flex justify-content-between align-items-center">
    <h3 class="pt-1"><?=$project['project_name']?></h3>
    <div>
        <a href="/<?=$base_url?>" class="btn rounded-pill btn-outline-secondary">
            <i class="fas fa-angle-double-left me-1"></i>Projects
        </a>
    </div>
</div>
<br>

<div class="card bg-white">
    <?php if(user::init()->user_can('view_project_budget')){?>
    <div class="d-flex justify-content-between align-items-center p-2">
        <div class="col-md-4">
            <strong>Project budget</strong><br>
            <?=$registry->system_config->currency_symbol?> <?=number_format($project['project_budget'])?>
        </div>
        <div class="col-md-4 text-right">
            <strong>Budget used</strong><br>
            <?=$project['project_budget']?>
        </div>
        <div class="col-md-4 text-right">
            <strong>Remaining fund</strong><br>
            <?=$project['project_budget']?>
        </div>
    </div><hr>
    <?php }?>
    <div class="d-flex justify-content-between align-items-center p-2">
        <div class="col-md-6">
            <div>
                <strong>Start date: </strong>
                <?=system::format_time($project['project_start'], 3)?>
            </div>
            <div>
                <strong>End date: </strong>
                <?=system::format_time($project['project_end'], 3)?>
            </div>
            <div>
                <strong>Project duration: </strong>
                <?=(strtotime($project['project_end'])-strtotime($project['project_start']))/(3600*24)?> days
            </div>
        </div>
        <div class="col-md-6">
            <strong>Project description</strong><br>
            <?=$project['project_desc']?>
        </div>
    </div><hr>
    <div class="d-flex justify-content-between align-items-center p-2">
        <div class="col-md-6">
            <strong>Project manager</strong><br>
            <img src="<?=user::init()->get_user_avatar($project['project_manager'])?>" height="40" style="vertical-align: top;">
            <span style="display: inline-block;">
                <strong><?=$project['manager']?></strong><br>
                <em><?=$project['branch_name']?></em>
            </span>
        </div>
        <div class="col-md-6">
            <strong>Project client</strong><br>
        </div>
    </div><hr>
    <pre><?php var_dump($resources,$project)?></pre>
</div>

<template>
    <?php include __DIR__.'/register_project.html';?>
</template>
<style>
    .mySwalForm{
        min-width: 80%;
    }
    .mySwalForm :placeholder-shown, .mySwalSmallForm :placeholder-shown{
        font-family: 'Times New Roman', Times, serif;
        font-style: italic;
    }
    .mySwalForm label, .mySwalSmallForm label{
        display: block;
        text-align: left;
        padding-left: 1em;
    }
    .mySwalSmallForm label{
        padding: .5em;
        padding-top: 1em;
    }
</style>
<script>
    const register_project = (name)=>{
        let fx = document.querySelector('template').content.cloneNode(true).children[0];
        Swal.fire({
            html: fx,
            customClass: 'mySwalSmallForm',
            showConfirmButton: false
        });
        document.querySelector('.mySwalSmallForm form').addEventListener('submit', evt=>{
            evt.preventDefault();
            evt.target.querySelector('[type=submit]').innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
            let fdx = new FormData(evt.target);
            fdx.append('ajax_request', 1);
            ajax(
                window.location.href,
                response=>{
                    if(response.startsWith('{')){
                        let jsx = JSON.parse(response);
                        Swal.fire({
                            icon: jsx.status,
                            title:jsx.message
                        });
                    }
                    else{
                        Swal.fire({
                            icon: 'info',
                            html: response
                        });
                    }
                },
                error=>{
                    Swal.fire(error);
                },
                fdx
            );
        });
    }
</script>