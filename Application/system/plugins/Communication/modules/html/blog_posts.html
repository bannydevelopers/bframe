<div class="flex content" style="display: flex;">
    <h1>Blog posts</h1>
    <button class="flex-shrink round" onclick="add_post()">ADD POST</button>
</div>
<?php if(isset($msg) && $msg){?>
<p class="box-shadow msg rounded"><?=$msg?></p>
<?php }?>
<div class="flex cards">
    <?php foreach($posts as $p){?>
    <div class="rounded">
        <h3 style="text-transform: none;font-size: 120%;" class="content-small"><?=$p['post_title']?></h3>
        <div class="white flex">
            <div><?=$p['post_id']?></div>
            <div><?=$p['post_content']?></div>
        </div>
    </div>
    <?php } ?>
</div>
<style>
    .mySwal label, .wideSwal label{
        text-align: left;
        display: block;
        padding: 6px;
    }
    .wideSwal{
        min-width: 80%;
    }
    .flex{
        display: flex;
    }
    .flex > *{
        flex-basis: 100%;
    }
    .flex > .flex-shrink{
        flex-basis: auto;
    }
    button{
        border: none;
        white-space: nowrap;
    }
    .cards > *{
        box-shadow: 0 0 5px #999;
        margin: 1em;
    }
    input,select{
        width: 100%;
    }
</style>
<template>
    <form method="post" class="content-small">
        <div class="flex">
            <div class="content-small">
                <label>Post title</label>
                <input type="text" name="post_title" placeholder="short and descriptive title">
            </div>
            <div class="content-small">
                <label>Category</label>
                <select name="post_category">
                    <option value="0">General</option>
                </select>
            </div>
            <div class="flex-shrink">
                <label>&nbsp;</label>
                <button type="submit" class="content-small">Save</button>
            </div>
        </div>
        <div class="content-small">
            <label>Content</label>
            <textarea name="post_content" class="tinymce"></textarea>
        </div>
    </form>
</template>
<script>
    const add_post = ()=>{
        let htz = document.querySelector('template').content.children[0].cloneNode(true);
        Swal.fire({
            title: 'Create blog post',
            html: htz,
            customClass: 'wideSwal',
            showConfirmButton: false
        });
        document.querySelector('.wideSwal form').addEventListener('submit', evt=>{
            evt.preventDefault();
            let elem = evt.target;
            let fdx = new FormData(elem);
            fdx.append('ajax_request', 1);
            ajax(
                window.location.href,
                response=>{
                    console.log(response);
                    let jsx = JSON.parse(response);
                    if(jsx){
                        Swal.fire({
                            icon: jsx.status,
                            html: jsx.message
                        })
                        .then(any=>{
                            /*let inpt = document.createElement('input');
                            inpt.type = 'hidden';
                            inpt.name = 'post_id';
                            elem.appendChild(inpt);*/
                        });
                    }
                },
                error=>{
                    console.log(error);
                },
                fdx
            )
        });
        init_rich_editor();
    }
</script>