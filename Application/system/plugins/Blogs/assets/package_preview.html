<div style="max-width: 1024px;margin: auto;">
    <h1 class="content-small capitals" style="text-align: center;" data-icon="<?=$page['page_icon']?>">
        &nbsp;<?=$page['page_name']?>
    </h1>
    <div class="flexx white content rounded" style="box-shadow: 0 0 16px #999;">
        <div style="flex-basis: 80%;" class="white">
            <div class="flex">
                <p><img src="<?=$src?>/<?=$photos[0]?>" width="100%"></p>
                <div class="content-small shrink" style="padding-top: 0;">
                    <?php foreach($photos as $p){?>
                    <span class="block-lg">
                        <img src="<?=$src?>/<?=$p?>" height="50">
                    </span>
                    <?php } ?>
                </div>
            </div>
        </div>
        <div style="flex-basis: 100%;">
            <div class="content-small">
                <div><?=$page['page_content']?></div>
                <span style="position: fixed; bottom: 1em;right: 1em;">
                    <button onclick="showBookForm()" class="green content">Book Now</button>
                </p>
            </div>
        </div>
    </div>
    <form method="post" id="book" class="light-grey content" style="box-shadow: 0 0 16px #999;" autocomplete="off">
        <h2 class="capitals center">Make reservation</h2>
        <hr>
        <div class="flex">
            <div class="content">
                <div class="flex">
                    <p class="content-small">
                        <label><span style="color: #fc008a;">*</span> Full name</label>
                        <input type="text" name="fullname" placeholder="At least two" patternx="([a-zA-Z]+\s){1,}([a-zA-Z]+)" required>
                    </p>
                    <p class="content-small">
                        <label><span style="color: #fc008a;">*</span> Country of residence</label>
                        <select name="country" required>
                            <option value="">Choose...</option>
                            <?php foreach(system::get_countries() as $cn){?>
                            <option value="<?=$cn->code?>"<?=$cn->code == 'TZ' ? ' selected' : ''?>><?=$cn->name?></option>
                            <?php }?>
                        </select>
                    </p>
                </div>
                <div class="flex">
                    <p class="content-small">
                        <label><span style="color: #fc008a;">*</span> Phone number</label>
                        <input type="tel" name="phone" placeholder="...active and reachable number" required>
                    </p>
                    <p class="content-small">
                        <label><span style="color: #fc008a;">*</span> E-mail</label>
                        <input type="email" name="email" placeholder="...valid and active email" required>
                    </p>
                </div>
                <div class="flex">
                    <p class="content-small">
                        <label><span style="color: #fc008a;">*</span> Adults</label>
                        <input type="number" min="1" name="adults" placeholder="At least 16 years old" onkeyup="update_price()" required>
                    </p>
                    <p class="content-small">
                        <label><span style="color: #fc008a;">*</span> Children</label>
                        <input type="number" min="0" name="children" placeholder="Less than 16 years old" onkeyup="update_price()">
                    </p>
                </div>
                <p>
                    <label for="requests">Special requests</label>
                    <textarea name="requests" placeholder="Optional, personal requests if any..."></textarea>
                </p>
            </div>
            <div class="content" style="padding-top: 0;">
                <h3>Booking summery</h3>
                <div class="content" style="box-shadow: 0 0 4px #aaa;">
                    <div class="flex">
                        <p>
                            <b data-price="<?=$page['page_extras']['price']?>">Price per person:</b><br>
                            <span><?=$registry->system_config->currency?>&nbsp;<?=number_format($page['page_extras']['price'])?></span>
                        </p>
                        <p>
                            <b data-kido-discount="<?=$page['page_extras']['kido_discount']?>">Children discount:</b><br>
                            <span><?=intval($page['page_extras']['kido_discount'])?>%</span>
                        </p>
                    </div>
                    <p>
                        <b data-legal-tax="0">Legal tax:</b><br>
                        <?=$registry->system_config->currency?>&nbsp;<span>0</span>
                    </p>
                    <p>
                        <b>Total price</b>
                    </p>
                    <div class="flex">
                        <p>
                            <b>Before tax:</b><br>
                            <?=$registry->system_config->currency?>&nbsp;<span id="price_before_tax">0</span>
                        </p>
                        <p>
                            <b>Including tax:</b><br>
                            <?=$registry->system_config->currency?>&nbsp;<span id="price_after_tax">0</span>
                        </p>
                    </div>
                    <hr />
                    <p style="font-family: 'Times New Roman', Times, serif;">
                        <sup>*</sup><em>Terms and conditions apply</em>
                    </p>
                </div>
                <p class="content" style="text-align: right;">
                    <button class="white">Book</button>
                </p>
            </div>
        </div>
    </form>
</div>
<style>
    /*#book{
        transform-origin: top;
        transform: scaleY(0);
        transition: all .4s ease-in-out;
        height: 0;
    }
    #book:target{
        transform: scaleY(1);
    }*/
    #book input,#book select,#book textarea, .btn, button{
        box-shadow: 0 0 1px #999;
        color: #222;
        width: 99%;
        transition: .3s;
    }
    #book input:focus,#book select:focus,#book textarea:focus{
        box-shadow: 0 0 6px #999;
        background-color: #fafafa;
    }
    .btn, button{
        border-radius: 3em;
        padding: 1em 2.4em;
        width: auto;
    }
    #book label{
        display: block;
    }
    @media screen and (min-width:800px) {
        .block-lg{
            display: block;
            padding-bottom: 6px;
        }
    }
</style>
<script>
    const update_price = ()=>{
        let price = document.querySelector('[data-price]').getAttribute('data-price'),
            kido_discount = document.querySelector('[data-kido-discount]').getAttribute('data-kido-discount'),
            legal_tax = document.querySelector('[data-legal-tax]').getAttribute('data-legal-tax'),
            price_before_tax  = document.getElementById('price_before_tax'),
            price_after_tax  = document.getElementById('price_after_tax'),
            adults = document.querySelector('[name=adults]').value,
            kidos = document.querySelector('[name=children]').value;
            if(adults == '') return;
            if(kidos == '') kidos = 0;
        let adults_price, kidos_price, taxed;
        adults_price = adults * price;
        kidos_price = kidos * (price - (price * kido_discount));
        total_price = adults_price + kidos_price;
        price_before_tax.innerHTML = total_price;
        price_after_tax.innerHTML = total_price + (total_price * legal_tax);
        console.log(kidos_price);
    }
</script>