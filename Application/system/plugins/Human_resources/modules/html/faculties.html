<div class="flex">
    <h1 class="content-small no-pad-top">Faculties</h1>
    <div class="shrink">
        <button onclick="add_faculty()">Add faculty</button>
    </div>
</div>
<hr>
<!--?php foreach($f_tree as $key=>$faculties){?>
<h3 class="content grey round">< ?=$key?></h3-->
<div class="flex cards">
    <?php foreach($faculties as $k=>$f){?>
    <div>
        <h3 class="grey" style="text-align: left;"><?=$f['faculty_name']?></h3>
        <div class="content"><em><?=$f['faculty_desc']?></em></div>
        <div class="content-small no-pad-top" style="text-align: right;">
            <button class="round" onclick="view_faculty(<?=$f['faculty_id']?>)" data-icon="&#xf06e;"></button>
            <button class="round" onclick="edit_faculty(<?=$f['faculty_id']?>)" data-json='<?=stripslashes(json_encode($f))?>' data-icon="&#xf044;"></button>
            <button class="round" onclick="delete_faculty(<?=$f['faculty_id']?>,'<?=$f['faculty_name']?>')" data-icon="&#xf2ed;"></button>
        </div>
    </div>
    <?php }?>
</div>
<!--?php }?-->
<!--div>
    <pre>
        <?php var_dump($c_tree)?>
    </pre>
</div-->
<div style="display: none;" id="faculty_form">
    <form method="post">
        <label>Faculty name</label>
        <input type="text" name="faculty_name" placeholder="faculty name..." required>
        <!--label>Faculty department</label>
        <select name="faculty_dept" required>
            <option value="">Choose department...</option>
            <?php foreach($depts as $d){?>
            <option value="<?=$d['dept_id']?>"><?=$d['dept_name']?></option>
            <?php }?>
        </select-->
        <label>Faculty description</label>
        <textarea name="faculty_desc" rows="6" placeholder="faculty description..."></textarea>
        <div class="content" style="text-align: right;">
            <button type="submit">Save faculty</button>
        </div>
    </form>
</div>
<style>
    .no-pad-top{
        padding-top: 0;
    }
    .round{
        border-radius: 5em;
    }
    .cards > *{
        min-width: 47%;
    }
    button{
        text-transform: uppercase;
    }
    .mySwal label{
        display: block;
        text-align: left;
        padding-left: .5em;
        font-weight: bolder;
    }
</style>
<script>
    function add_faculty(){
        let targ = window.event.target;
        Swal.fire({
            title:"Add new faculty<hr>",
            html:document.getElementById('faculty_form').innerHTML,
            customClass:'mySwal',
            showConfirmButton:false
        });
    }
    function view_faculty(id){
        var cancelled = false;
        Swal.fire({
            title:`Loading, please wait...`,
            icon:'info',
            showCancelButton:true,
            showConfirmButton:false
        })
        .then(res=>{
            cancelled = true;
        });
        Swal.showLoading();
        setTimeout(()=>{
            if(!cancelled){
                Swal.fire({
                    title:'No enough data to show',
                    icon:'info',
                    showCancelButton:false,
                    showConfirmButton:true
                });
            }
        },2000);
    }
    function delete_faculty(id, name){
        Swal.fire({
            title:`Sure, delete '${name}?'`,
            icon:'question',
            showCancelButton:true
        })
        .then(prompt=>{
            if(prompt.isConfirmed){
                let fd = new FormData();
                fd.append('faculty_id', id);
                fd.append('delete_faculty', 'ajax'),
                ajax(
                    req_uri,
                    response=>{
                        if(response == 'ok')
                        {
                            Swal.fire({
                                title:'Deleting succeeded!',
                                icon:'success'
                            })
                            .then(prompt=>{
                                window.location.reload();
                            });
                        }
                        else{
                            Swal.fire({
                                title:response,
                                icon:'error'
                            });
                        }
                    },
                    error=>{
                        Swal.fire({
                            title:error,
                            icon:'error'
                        });
                    },
                    fd
                );
            }
            else{
                Swal.fire({
                    title:'Deleting cancelled!',
                    icon:'success'
                });
            }
        });
    }
    function edit_faculty(id){
        let targ = window.event.target,
            form_html = document.getElementById('faculty_form').children[0].innerHTML,
            _json = JSON.parse(targ.getAttribute('data-json'));
        let tmp = document.createElement('form');
        tmp.setAttribute('method', 'POST');
        tmp.innerHTML = form_html;
        tmp.querySelector('[name=faculty_name]').setAttribute('value',_json.faculty_name);
        tmp.querySelector('[name=faculty_desc]').innerText = _json.faculty_desc;
        /*let opts = tmp.querySelector('[name=faculty_dept]').children;
        for(var i = 1; i < opts.length; ++i){
            if(opts[i].value == _json.faculty_dept) opts[i].setAttribute('selected', true);
        }*/
        tmp.insertAdjacentHTML('beforeEnd',`<input type="hidden" name="faculty_id" value="${id}"></form>`);
        Swal.fire({
            title:"Edit faculty<hr>",
            html:tmp.outerHTML,
            customClass:'mySwal',
            showConfirmButton:false
        });
    }
</script>