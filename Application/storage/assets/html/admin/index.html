<!DOCTYPE html>

<html>
    <head data-uri="<?=$url?>">
        <base href="<?=storage::get_instance()->install_dir?>"/>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta property="og:image" content="app/storage/uploads/images/logo.png" />
        <link rel="shortcut icon" type="image/png" href="app/storage/uploads/images/logo.png">
        <meta property="og:url" content="https://<?=$_SERVER['HTTP_HOST']?>" />
        <title>Dashboard <?=(!empty(trim($title)) ? (" | {$title}") : '')?></title>
        
        <!-- suneditor -->
        <link href="vendor/suneditor/dist/css/suneditor.min.css" rel="stylesheet">
        <!-- codeMirror -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.49.0/lib/codemirror.min.css">
        <!-- KaTeX -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
        
        <style>
            @font-face {
                font-family: 'FontAwesome';
                src: url('vendor/components/font-awesome/webfonts/fa-solid-900.eot'),
                    url('vendor/components/font-awesome/webfonts/fa-solid-900.eot?#iefix') format('embedded-opentype'),
                    url('vendor/components/font-awesome/webfonts/fa-solid-900.svg#FontAwesome5Free-Solid') format('svg'),
                    url('vendor/components/font-awesome/webfonts/fa-solid-900.ttf') format('truetype'),
                    url('vendor/components/font-awesome/webfonts/fa-solid-900.woff') format('woff'),
                    url('vendor/components/font-awesome/webfonts/fa-solid-900.woff2') format('woff2');
                font-weight: normal;
                font-style: normal;
                font-display: swap;
            }
            [data-icon]:before {
                font-family: FontAwesome;
                -webkit-text-rendering: optimizeLegibility;
                -moz-text-rendering: optimizeLegibility;
                -ms-text-rendering: optimizeLegibility;
                -o-text-rendering: optimizeLegibility;
                text-rendering: optimizeLegibility;
                -webkit-font-smoothing: antialiased;
                -moz-font-smoothing: antialiased;
                -ms-font-smoothing: antialiased;
                -o-font-smoothing: antialiased;
                /*font-smoothing: antialiased;*/
                content:attr(data-icon);
                margin-right:0.3em;
                font-size:90%;
            }
            :root{
                --green: #25996C;
                --white: #ffffff;
                --yellow: #FFDD44;
                --light: #F6F8FC;
                --grey:#EAF1FB;
                --dark:#999;
                --primary-bg: #2D4A8A;
                --primary-txt: #ffffff;
            }

                /* Styles, not important */
            *, *:before, *:after {
                position: relative;
                box-sizing: border-box;
                line-height: 1em;
            }

            html {
                position: relative;
                height: 100%;
            }
            body{
                font-family: 'custom', Arial, Helvetica, sans-serif;
                background-color: var(--light);
                height: 100%;
                max-width: 99%;
                margin: auto;
                box-sizing: border-box;
                padding: 0;
                margin: 0;
            }
            h1,h2,h3,h4,h5,h6{
                margin: 0;
            }
            a, span, b,small,i,em{
                display: inline-block;
            }
            h2 {
                font-weight: normal;
            }
            img{
                vertical-align: middle;
                max-width: 100%;
            }
            a,a:visited{
                color: #551A8B;
                cursor: pointer;
                text-decoration: none;
            }
            em{
                font-family: 'Times New Roman', Times, serif;
            }
            ul{
                list-style: none;
                padding-left: 0;
                margin: 0;
            }
            li > ul{
                padding-left: 12px;
            }
            table{
                width: 100%;
                border-collapse: collapse;
                box-shadow: 0 0 6px #aaa;
                border-radius: 6px;
                font-size: 96%;
            }
            tr:nth-of-type(odd){
                background-color: var(--light);
            }
            tr:hover {
                background-color: var(--grey);
                box-shadow: 0 0 3px #999;
            }
            tr{
                border-top: 1px solid var(--grey);
            }
            tr:first-child{
                border-top: 0;
            }
            td,th{
                padding: 9px;
                text-align: left;
                vertical-align: top;
            }
            tr *{
                line-height: 1.35;
            }
            th{
                background-color: var(--grey);
                text-transform: uppercase;
            }
            td{
                font-size: 96%;
            }
            .table{
                display: flex;
                overflow-x: auto;
            }
            .table > *{
                background-color: #f1f1f1;
                margin-bottom: 1rem;
                background-color: #fefefe;
                box-shadow: 0 -1px 1px #eee;
                white-space: nowrap;
                padding: 0 1em;
            }
            .table > *:nth-of-type(odd){
                background-color: #fafafa;
            }
            .table > *:first-child{
                background-color: #f1f1f1;
                box-shadow: 0 -1px 1px #ddd;
                font-size: 1em;
                white-space: nowrap;
            }
            .table > * > *{
                display: block;
            }
            label{
                display: block;
                padding: 12px 0;
            }
            input,select,textarea,[contenteditable]{
                padding: 10px;
                border: none;
                background: transparent;
                width: 96%;
                font-size: 102%;
                box-shadow: 0 0 1px #aaa;
            }
            input:focus,select:focus,textarea:focus,[contenteditable]:focus{
                outline: none;
                box-shadow: 0 0 4px #aaa;
            }
            input[type=button],input[type=submit],input[type=reset],button,.btn{
                cursor: pointer;
                border: none;
                box-shadow: 0 0 3px #aaa;
                padding: 12px 18px;
                margin: 3px;
             }
             input[type=button],input[type=submit],input[type=reset],button,input[type=checkbox]{
                 display: inline-block;
                 width: auto;
             }
             input[type=checkbox] ~ label,input[type=radio] ~ label{
                 display: inline-block;
             }

            .content{
                padding: 16px;
            }
            .content-small{
                padding: 8px;
            }
            .white{
                background-color: var(--white);
                color: var(--primary-bg);
            }
            .grey{
                background-color: var(--grey);
            }
            .light{
                background-color: var(--light);
            }
            .strips > *:nth-of-type(even){
                background: #f5f5f5;
                color: #111;
            }
            /*.flex, .vertical-flex{
                flex: 1;
            }*/
            .flex > *, .vertical-flex > *{
                flex-grow: 1;
            }
            .flex > .shrink, .vertical-flex > .shrink, .flex > .flex-shrink, .vertical-flex > .flex-shrink{
                flex-grow: 0;
                flex-shrink: 1;
                flex-basis: auto;
            }
            .plain-btn{
                border: none;
                background: transparent;
                box-shadow: none;
            }
            .xl{
                font-size: 120%;
            }
            .xxl{
                font-size: 200%;
            }
            .round{
                border-radius: 8em;
            }
            .rounded{
                border-radius: 8px;
            }
            .icon-only{
                width: 3em;
            }
            .side-nav > ul > li{
                padding-left: 2em;
                background: transparent;
                border-radius: 0 1em 1em 0;
                margin-right: 18px;
                margin-bottom: 6px;
            }
            .side-nav li > ul{
                margin-left: 1em;
            }
            .side-nav li{
                position: relative;
            }
            .side-nav .active{
                background: #D3E3FD;
            }
            .side-nav li a{
                color: #001D35;
                text-decoration: none;
                padding: 8px;
                display: block;
            }
            .side-nav li a::before{
                padding-right: 1em;
            }
            .side-nav li > ul a::before{
                padding-right: .3em;
            }
            .side-nav li > ul a{
                /*white-space: nowrap;*/
                text-overflow: ellipsis;
                font-size: 90%;
            }
            .side-nav  li > [type=checkbox]{
                display: none;
            }
            .serach-form{
                background-color: var(--grey);
                display: flex;
                transition: all .4s;
            }
            .serach-form:focus-within{
                background-color: var(--white);
                box-shadow: 0 0 5px #aaa;
                transition: all .4s;
            }
            .serach-form input{
                font-size: 102%;
                box-shadow: none;
            }
            .serach-form input:focus{
                box-shadow: none;
            }
            .side-nav  li > [type=radio]{
                display: none;
            }
            nav.side-nav{
                position: fixed;
                top: 3.2em;
                bottom: 0;
                left: -88%;
                z-index: 3;
                box-shadow: 0 0 3px #aaa;
                width: 85%;
                background: var(--grey);
                transition: all .4s;
            }
            nav.side-nav.visible{
                left: 0;
                left: 0;
                transition: all .4s;
            }
            .mobile-hidden{
                display: none;
            }
            #profiler ~ span{
                text-align: left;
                line-height: 1.45;
                font-size: 85%;
                padding: 1em;
                position: absolute;
                right: -0.7em;
                min-width: 200px;
                background-color: var(--white);
                box-shadow: 0 0 3px #aaa;
                border-radius: 8px 0 8px 8px;
                display: none;
            }
            #profiler ~ span > *{
                padding: 6px;
            }
            #profiler:checked ~ span{
                display: block;
            }

            .cards > *, .card{
				/*border: 4px solid var(--white);*/
				margin: 16px 8px;
				box-shadow: 0 0 3px var(--dark);
				overflow: hidden;
			}
			.cards > * img, .card img{
				transform-origin: bottom;
				transition: transform .5s ease-in-out;
			}
			.cards > * h3, .card h3, .cards > * h4, .card h4{
				padding: 16px;
				text-align: center;
				text-transform: uppercase;
			}
			.cards > * h3, .card h3, .cards > * h4, .card h4,
			.cards > * h3 a, .card h3 a, .cards > * h4 a, .card h4 a{
				color: var(--orange);
			}
			.cards > * p, .card p{
				text-align: justify;
				padding: 16px;
			}
			.cards > * img:hover, .card img:hover{
				transform-origin: bottom;
				transform: scale(1.2);
				transition: transform .5s;
			}
            /* Pagination*/
            .pagination {
                text-align: center;
            }

            .pagination button {
                padding: 5px 10px;
                margin: 0 5px;
                cursor: pointer;
                outline: 1px solid #494a4f;
                border-radius: 1px;
                border: none;
            }

            .hidden {
                clip: rect(0 0 0 0);
                clip-path: inset(50%);
                height: 1px;
                overflow: hidden;
                position: absolute;
                white-space: nowrap;
                width: 1px;
            }

            .pagination button.active {
                background-color: #007bff;
                color: white;
            }
            /* End*/
            @media screen and (min-width:500px) {
				.cards{
					display: flex;
					flex-wrap: wrap;
					justify-content: left;
					flex-wrap: wrap;
				}
				.cards > *, .card{
					position: relative;
					margin: 1.5%;
					width: 47%;
					max-width: 47%;
				}
			}
            .capitals{
                text-transform: uppercase;
            }
			@media screen and (min-width:800px) {
				.cards > *, .card{
					margin: 1.5%;
					width: 30.3%;
					max-width: 30.3%;
				}
				.cards > * .overlay, .card .overlay{
					position: absolute;
					bottom: 0;
                    width: 100%;
					background: rgba(255, 255, 255, .7);
					transform-origin: bottom;
					transform: scaleY(0);
					transition: all .4s;
				}
				.cards > *:hover .overlay, .card:hover .overlay{
					transform: scaleY(1);
					transition: all .4s;
				}
				.cards-4 > *{
					width: 22%;
					max-width: 22%;
				}
            }
            @media screen and (min-width:800px) {  
                .mobile-hidden{
                    display: inherit;
                }
                .side-nav  li > [type=radio]{
                    position: absolute;
                    right: 1em;
                    top: .3em;
                    display: block;
                    max-width: 0px;
                    padding: 8px;
                    cursor:s-resize;
                }
                .side-nav li > ul{
                    transform: scaleY(0);
                    transition: all .4s;
                    transform-origin: top;
                    height: 0;
                }
                .side-nav li > [type=radio]{
                    transition: all .4s;
                }
                .side-nav li > [type=radio]:checked{
                    transform-origin: left;
                    transform: rotate(180deg) translateX(-0.7em);
                    transition: all .4s;
                }
                .side-nav li > [type=radio]:checked ~ ul,.side-nav ul:target{
                    transform: scaleY(1);
                    transition: all .4s;
                    height: 100%;
                }
                nav.visible li > [type=radio]:checked ~ ul{
                    transform: scaleY(0);
                    transition: all .4s;
                    height: 0;
                }
                nav.side-nav{
                    position: relative;
                    top: unset;
                    bottom: unset;
                    left: unset;
                    z-index: unset;
                    box-shadow: none;
                    width: 240px;
                    background: transparent;
                    transition: all .4s;
                } 
                .side-widget{
                    width: 240px;
                    min-width: 240px;
                }
                .side-widget.visible, nav.visible{
                    width: 5.4em;
                    min-width: auto;
                    transition: all .4s;
                }
                nav.visible [type=radio]{
                    display: none;
                }
                nav.side-nav.visible a{
                    white-space: nowrap;
                }
                nav.side-nav.visible > ul > li a > span{
                    white-space: nowrap;
                    max-width: 0;
                    overflow: hidden;
                }
                nav.visible li > ul > li{
                    position: relative;
                    background-color: var(--grey);
                }
                nav.visible li:hover > ul,nav.visible li:hover > [type=radio]:checked ~ ul{
                    position: absolute;
                    top: .4em;
                    left: 2em;
                    width: auto;
                    z-index: 3;
                    transform: scaleY(1);
                }
                .fill-parent{
                    min-height: calc(100vh - 5em);
                }
                .flex{
                    display: flex;
                }
                .vertical-flex{
                    display: flex;
                    flex-direction: column;
                }
            }
            @media print{
                .no-print{
                    display: none;
                }
            }
        </style>
        <!--TinyMCE-->
        <style>
            figure.image {
              display: inline-block;
              border: 1px solid gray;
              margin: 0 2px 0 1px;
              background: #f5f2f0;
            }
            
            figure.align-left {
              float: left;
            }
            
            figure.align-right {
              float: right;
            }
            
            figure.image img {
              margin: 8px 8px 0 8px;
            }
            
            figure.image figcaption {
              margin: 6px 8px 6px 8px;
              text-align: center;
            }
            /*
             Alignment using classes rather than inline styles
             check out the "formats" option
            */
            img.align-left {
              float: left;
            }
            img.align-right {
              float: right;
            }
            #tinymce-filemanager{
              position: fixed;
              left: calc( ( 100% - 600px ) / 2 );
              right: calc( ( 100% - 600px ) / 2 );
              top: 4em;
              padding: 2px;
              background: rgba(0, 0, 0, 0.8);
              z-index: 9999;
              display: none;
            }
            #tinymce-filemanager > div{
              max-width: 600px;
              max-height: 400px;
              background: #fff;
              border: 1px solid #999;
            }
            /* Tabs*/
            .tabset > input[type="radio"] {
                position: absolute;
                left: -200vw;
            }
            .tabset .tab-panel {
                display: none;
                padding: 0;
            }
            .tabset > input:first-child:checked ~ .tab-panels > .tab-panel:first-child,
            .tabset > input:nth-child(3):checked ~ .tab-panels > .tab-panel:nth-child(2),
            .tabset > input:nth-child(5):checked ~ .tab-panels > .tab-panel:nth-child(3),
            .tabset > input:nth-child(7):checked ~ .tab-panels > .tab-panel:nth-child(4),
            .tabset > input:nth-child(9):checked ~ .tab-panels > .tab-panel:nth-child(5),
            .tabset > input:nth-child(11):checked ~ .tab-panels > .tab-panel:nth-child(6) {
                display: block;
            }
            .tabset > label {
                position: relative;
                display: inline-block;
                padding: 18px;
                margin-top: 2px;
                margin-left: 2px;
                border-bottom: 3px solid transparent;
                cursor: pointer;
                font-size: 80%;
            }
            .tabset > label:hover,
            .tabset > input:focus + label {
                color: #06c;
            }
            .tabset > label:hover::after,
            .tabset > input:focus + label::after,
            .tabset > input:checked + label::after {
                background: #06c;
            }
            .tabset > input:checked + label {
                border-color: #ccc;
            }
            .tab-panel {
                padding: 30px 0;
                border-top: 1px solid #ccc;
            }
            /*.tab-panel > *{
                padding: 1em;
            }*/
            
			/* Tabs */
			
			.tab-view > input{
				display: none;
			}
			.tab-view > label{
				padding: .6em 1em .3em 0;
				border-bottom: 3px solid transparent;
				display: inline-block;
			}
			.tab-view > input:checked + label{
				border-bottom: 3px solid #ccc;
			}
			.tab-panes{
				display: grid;
				overflow: hidden;
				border-top: 1px solid #ddd;
                padding: 0;
			}
			.tab-panes > *{
				grid-area: 1 / 1;
				transition: all .3s;
				visibility: hidden;
				z-index: -1;
                padding-top: 4px;
			}
			.tab-view > input:nth-child(1):checked ~ .tab-panes > *:nth-child(1){
				visibility: visible;
				transition: all .3s;
				z-index: 1;
			}
			.tab-view > input:nth-child(3):checked ~ .tab-panes > *:nth-child(2){
				visibility: visible;
				transition: all .3s;
				z-index: 1;
			}
			.tab-view > input:nth-child(5):checked ~ .tab-panes > *:nth-child(3){
				visibility: visible;
				transition: all .3s;
				z-index: 1;
			}
			.tab-view > input:nth-child(7):checked ~ .tab-panes > *:nth-child(4){
				visibility: visible;
				transition: all .3s;
				z-index: 1;
			}
			.tab-view > input:nth-child(9):checked ~ .tab-panes > *:nth-child(5){
				visibility: visible;
				transition: all .3s;
				z-index: 1;
			}
			.tab-view > input:nth-child(11):checked ~ .tab-panes > *:nth-child(6){
				visibility: visible;
				transition: all .3s;
				z-index: 1;
			}
			/* end tabs*/
            .highlight{
                box-shadow: 0 0 3px #999;
            }
            .actions > *{
                padding: .3em 1em;
                border-right: 1px solid #ddd;
                font-size: 90%;
            }
            .actions [data-icon]::before{
                font-size: 100%;
            }
            /* /Tbas */
        </style>
        <!--/TinyMCE-->
        <script src="vendor/components/sweetalert/sweetalert2@11.js"></script>
        <script>
            var useDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            var req_uri = document.querySelector('head').getAttribute('data-uri');
            const ajax = (url, success, fail, data, method)=>{
                fetch(
                    url, 
                    {
                        method: method || 'POST', /* or 'PUT'*/
                        mode:"no-cors",/*cors, same-origin*/
                        body: data
                    }
                )
                .then(response => response.text())
                .then(data => {success(data);})
                .catch((error) => {fail(error);});
            };
            const request_service = (event_action, callback, data)=>{
                let base = document.querySelector('base').getAttribute('href'),
                    url_parts = req_uri.split('/'),
                    dash = [base, url_parts[1], `?ajax_event=${event_action}`].join('/').replace('//','/');
                ajax(
                    dash,
                    response=>{
                        callback(response, null);
                    },
                    error=>{
                        callback(null, error);
                    },
                    data
                );
            }
        </script>
    </head>
    <body>
        <div class="vertical-flex">
            <div style="position: sticky;top: 0;z-index: 3;background-color: var(--light);">
                <div class="flex">
                    <div class="shrink side-widget content-small">
                        <a id="toggler-bars" data-icon="&#xf0c9;" class="xl content"></a>
                        <!--img src="app/storage/assets/img/logo_gmail_lockup_default_1x_r5.png" height="40"-->
                        <b class="xl"><?=$conf->site_name?></b>
                    </div>
                    <div class="content-small flex mobile-hidden" style="padding-left: 0;">
                        <form class="rounded serach-form">
                            <button data-icon="&#xf002;" class="plain-btn xl content"></button>
                            <input type="search" name="q" placeholder="Search..." />
                        </form>
                        <div>
                            <div style="text-align: right;">
                                <span style="max-height:30px">
                                    <img onclick="this.nextElementSibling.click()" class="white" src="<?=user::init()->get_user_avatar()?>" height="30" style="border-radius: 3em;padding: 2px;">
                                    <input type="checkbox" id="profiler" style="max-width: 0;" data-icon="&#xf0d7;">
                                    <span style="padding: 0;">
                                        <img src="<?=user::init()->get_user_avatar()?>" width="100%">
                                        <a href="<?=storage::get_instance()->install_dir?>admin/profile" data-icon="&#xf2bd;" class="content-small">
                                            <?=user::init()->get_session_user('full_name')?>
                                        </a><br />
                                        <a class="content-small" data-icon="&#xf507;">
                                            <em><?=user::init()->get_session_user('role_name')?></em>
                                        </a><br />
                                        <a href="<?=$url?>?logout" class="content-small" data-icon="&#xf2f5;">Logout</a>
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div class="flex">
                    <nav class="shrink side-widget side-nav">
                        <ul>
                            <!-- Nav -->
                            <?php 
                                foreach($nav as $a){
                                    $req = @$address[1] == 'plugin' ? @$address[2] : @$address[1];
                                    $state = ($req == trim($a['href'],'/') or (isset($a['alias']) && $req == $a['alias']));
                                    if(!user::init()->user_can(trim($a['permission']))) continue;
                                    //echo $a['permission'],'...<br>';
                                    $admin = $conf->dashboard_url;
                                    if(strpos($a['href'], '#') === 0) $href = "{$_SERVER['REQUEST_URI']}{$a['href']}";
                                    else $href = "{$admin}{$a['href']}";
                            ?>
                                <li<?=$state ? ' class="active"' : ''?>>
                                    <a href="<?=$href?>" data-icon="&#x<?=$a['icon']?>;">
                                        <span><?=$a['name']?></span>
                                    </a>
                                    <?php if(isset($a['children'])){?>
                                    <input type="radio" name="subs-toggler" data-icon="&#xf0d7;">
                                    <ul id="<?=trim($a['href'],'/#')?>">
                                    <?php 
                                    foreach($a['children'] as $v){
                                        if(!user::init()->user_can(trim($v['permission']))) continue;
                                        if(strpos($v['href'], '#') === 0) $vref = "{$_SERVER['REQUEST_URI']}{$a['href']}";
                                        else $vref = "{$admin}{$v['href']}";
                                    ?>
                                      <li>
                                        <a href="<?=$vref?>" data-icon="&#xf0da;""><?=$v['name']?></a>
                                      </li>
                                    <?php }?>
                                    </ul>
                                  <?php }?>
                                </li>
                                <?php }?>
                            <!-- /Nav-->
                        </ul>
                    </nav>
                    <div>
                        <div class="flex" style="display: flex;">
                            <div class="white content rounded fill-parent">
                                <?=trim($title) ? "<h1 class='content-small'>{$title}</h1>":''?>
                                <div class="content-small" style="max-height: 76vh;overflow-y: auto;"><?=$page_content?></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            /* Nav collapse state management */
            const toggler = document.getElementById('toggler-bars');
            toggler.addEventListener('click', evt=>{
              document.querySelector('.side-nav').classList.toggle('visible');
              let tbs = document.querySelector('.side-nav').classList.contains('visible') ? 1 : 0;
              localStorage.setItem("tbs", tbs);
              console.log(localStorage.getItem("tbs"));
            });
            let tbar = localStorage.getItem("tbs");
            if(tbar && tbar == 1) {
                //document.querySelector('.side-nav').classList.add('visible');
            }
            /* message handling */
            const removeMe = targetElem=>{
                target.parentNode.removeChild(targetElem);
            };
            /*To do: querySelectorAll to remove all msg */
            const msg = document.querySelector('.msg');
            if(msg) msg.addEventListener('click', evt=>{
              removeMe(evt.target);
            });
            const error = document.querySelector('.error')
            if(error) error.addEventListener('click', evt=>{
              removeMe(evt.target);
            });
        </script>
        <div id="tinymce-filemanager">
        <div>
            <h3 style="background: #f3f3f3;display: flex;">
            <span style="padding:12px 18px;flex-basis:100%"><img src="app/storage/uploads/images/logo.png" height="25"> 
                &nbsp; File manager
            </span>
            <button type="button" id="newmedia">&plus;</button>
            <input type="file" name="newmedia" accept="image/*" style="display: none;">
            <button type="button" onclick="removemypopdiv()">&times;</button>
            </h3>
            <div style="padding: 12px;max-height: 300px;overflow-y: auto;background: #fff;">
            Loading...
            </div>
        </div>
        </div>
        <script src="vendor/tinymce/tinymce/js/tinymce.min.js"></script>
        <script>
        const tinyeditor = document.querySelector('textarea.tinymce');
        if(tinyeditor !== null){
            document.body.append(document.getElementById('tinymce-filemanager'));
            var removemypopdiv = function(){
                document.querySelector('#tinymce-filemanager').style.display = 'none';
                document.querySelector('#tinymce-filemanager > div > div').innerHTML = 'Loading...';
            };
            var uploadPhoto = function(){
                Swal.init({
                    title:'Upload..',
                    content:window.event.target.value
                });
            console.log(window.event.target.value);
            };
            //var useDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            var opts = {doc_root:document.querySelector('base').getAttribute('href'), selector:"page_content", height:420};
            var tinymce_opts = {
                selector: 'textarea.tinymce',
                valid_elementsÂ : ""
                    +"a[accesskey|charset|class|coords|dir<ltr?rtl|href|hreflang|id|lang|name"
                    +"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|rel|rev"
                    +"|shape<circle?default?poly?rect|style|tabindex|title|target|type],"
                    +"abbr[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"acronym[class|dir<ltr?rtl|id|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"address[class|align|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"applet[align<bottom?left?middle?right?top|alt|archive|class|code|codebase"
                    +"|height|hspace|id|name|object|style|title|vspace|width],"
                    +"area[accesskey|alt|class|coords|dir<ltr?rtl|href|id|lang|nohref<nohref"
                    +"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup"
                    +"|shape<circle?default?poly?rect|style|tabindex|title|target],"
                    +"base[href|target],"
                    +"basefont[color|face|id|size],"
                    +"bdo[class|dir<ltr?rtl|id|lang|style|title],"
                    +"big[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"blockquote[cite|class|dir<ltr?rtl|id|lang|onclick|ondblclick"
                    +"|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout"
                    +"|onmouseover|onmouseup|style|title],"
                    +"body[alink|background|bgcolor|class|dir<ltr?rtl|id|lang|link|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onload|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|onunload|style|title|text|vlink],"
                    +"br[class|clear<all?left?none?right|id|style|title],"
                    +"button[accesskey|class|dir<ltr?rtl|disabled<disabled|id|lang|name|onblur"
                    +"|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup|onmousedown"
                    +"|onmousemove|onmouseout|onmouseover|onmouseup|style|tabindex|title|type"
                    +"|value],"
                    +"caption[align<bottom?left?right?top|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"center[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"cite[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"code[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"col[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl|id"
                    +"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown"
                    +"|onmousemove|onmouseout|onmouseover|onmouseup|span|style|title"
                    +"|valign<baseline?bottom?middle?top|width],"
                    +"colgroup[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl"
                    +"|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown"
                    +"|onmousemove|onmouseout|onmouseover|onmouseup|span|style|title"
                    +"|valign<baseline?bottom?middle?top|width],"
                    +"dd[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],"
                    +"del[cite|class|datetime|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"dfn[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"dir[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"div[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"dl[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"dt[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],"
                    +"em/i[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"fieldset[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"font[class|color|dir<ltr?rtl|face|id|lang|size|style|title],"
                    +"form[accept|accept-charset|action|class|dir<ltr?rtl|enctype|id|lang"
                    +"|method<get?post|name|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onreset|onsubmit"
                    +"|style|title|target],"
                    +"frame[class|frameborder|id|longdesc|marginheight|marginwidth|name"
                    +"|noresize<noresize|scrolling<auto?no?yes|src|style|title],"
                    +"frameset[class|cols|id|onload|onunload|rows|style|title],"
                    +"h1[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"h2[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"h3[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"h4[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"h5[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"h6[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"head[dir<ltr?rtl|lang|profile],"
                    +"hr[align<center?left?right|class|dir<ltr?rtl|id|lang|noshade<noshade|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|size|style|title|width],"
                    +"html[dir<ltr?rtl|lang|version],"
                    +"iframe[align<bottom?left?middle?right?top|class|frameborder|height|id"
                    +"|longdesc|marginheight|marginwidth|name|scrolling<auto?no?yes|src|style"
                    +"|title|width],"
                    +"img[align<bottom?left?middle?right?top|alt|border|class|dir<ltr?rtl|height"
                    +"|hspace|id|ismap<ismap|lang|longdesc|name|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|src|style|title|usemap|vspace|width],"
                    +"input[accept|accesskey|align<bottom?left?middle?right?top|alt"
                    +"|checked<checked|class|dir<ltr?rtl|disabled<disabled|id|ismap<ismap|lang"
                    +"|maxlength|name|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onselect"
                    +"|readonly<readonly|size|src|style|tabindex|title"
                    +"|type<button?checkbox?file?hidden?image?password?radio?reset?submit?text"
                    +"|usemap|value],"
                    +"ins[cite|class|datetime|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"isindex[class|dir<ltr?rtl|id|lang|prompt|style|title],"
                    +"kbd[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"label[accesskey|class|dir<ltr?rtl|for|id|lang|onblur|onclick|ondblclick"
                    +"|onfocus|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout"
                    +"|onmouseover|onmouseup|style|title],"
                    +"legend[align<bottom?left?right?top|accesskey|class|dir<ltr?rtl|id|lang"
                    +"|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"li[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title|type"
                    +"|value],"
                    +"link[charset|class|dir<ltr?rtl|href|hreflang|id|lang|media|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|rel|rev|style|title|target|type],"
                    +"map[class|dir<ltr?rtl|id|lang|name|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"menu[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"meta[content|dir<ltr?rtl|http-equiv|lang|name|scheme],"
                    +"noframes[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"noscript[class|dir<ltr?rtl|id|lang|style|title],"
                    +"object[align<bottom?left?middle?right?top|archive|border|class|classid"
                    +"|codebase|codetype|data|declare|dir<ltr?rtl|height|hspace|id|lang|name"
                    +"|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|standby|style|tabindex|title|type|usemap"
                    +"|vspace|width],"
                    +"ol[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|start|style|title|type],"
                    +"optgroup[class|dir<ltr?rtl|disabled<disabled|id|label|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"option[class|dir<ltr?rtl|disabled<disabled|id|label|lang|onclick|ondblclick"
                    +"|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout"
                    +"|onmouseover|onmouseup|selected<selected|style|title|value],"
                    +"p[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|style|title],"
                    +"param[id|name|type|value|valuetype<DATA?OBJECT?REF],"
                    +"pre/listing/plaintext/xmp[align|class|dir<ltr?rtl|id|lang|onclick|ondblclick"
                    +"|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout"
                    +"|onmouseover|onmouseup|style|title|width],"
                    +"q[cite|class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"s[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],"
                    +"samp[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"script[charset|defer|language|src|type],"
                    +"select[class|dir<ltr?rtl|disabled<disabled|id|lang|multiple<multiple|name"
                    +"|onblur|onchange|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|size|style"
                    +"|tabindex|title],"
                    +"small[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"span[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"strike[class|class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title],"
                    +"strong/b[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"style[dir<ltr?rtl|lang|media|title|type],"
                    +"sub[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"sup[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title],"
                    +"table[align<center?left?right|bgcolor|border|cellpadding|cellspacing|class"
                    +"|dir<ltr?rtl|frame|height|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|rules"
                    +"|style|summary|title|width],"
                    +"tbody[align<center?char?justify?left?right|char|class|charoff|dir<ltr?rtl|id"
                    +"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown"
                    +"|onmousemove|onmouseout|onmouseover|onmouseup|style|title"
                    +"|valign<baseline?bottom?middle?top],"
                    +"td[abbr|align<center?char?justify?left?right|axis|bgcolor|char|charoff|class"
                    +"|colspan|dir<ltr?rtl|headers|height|id|lang|nowrap<nowrap|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|rowspan|scope<col?colgroup?row?rowgroup"
                    +"|style|title|valign<baseline?bottom?middle?top|width],"
                    +"textarea[accesskey|class|cols|dir<ltr?rtl|disabled<disabled|id|lang|name"
                    +"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onselect"
                    +"|readonly<readonly|rows|style|tabindex|title],"
                    +"tfoot[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl|id"
                    +"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown"
                    +"|onmousemove|onmouseout|onmouseover|onmouseup|style|title"
                    +"|valign<baseline?bottom?middle?top],"
                    +"th[abbr|align<center?char?justify?left?right|axis|bgcolor|char|charoff|class"
                    +"|colspan|dir<ltr?rtl|headers|height|id|lang|nowrap<nowrap|onclick"
                    +"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove"
                    +"|onmouseout|onmouseover|onmouseup|rowspan|scope<col?colgroup?row?rowgroup"
                    +"|style|title|valign<baseline?bottom?middle?top|width],"
                    +"thead[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl|id"
                    +"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown"
                    +"|onmousemove|onmouseout|onmouseover|onmouseup|style|title"
                    +"|valign<baseline?bottom?middle?top],"
                    +"title[dir<ltr?rtl|lang],"
                    +"tr[abbr|align<center?char?justify?left?right|bgcolor|char|charoff|class"
                    +"|rowspan|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title|valign<baseline?bottom?middle?top],"
                    +"tt[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],"
                    +"u[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup"
                    +"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],"
                    +"ul[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown"
                    +"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover"
                    +"|onmouseup|style|title|type],"
                    +"var[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress"
                    +"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style"
                    +"|title]",
                plugins: 'print preview paste importcss searchreplace autolink autosave save directionality '
                        +'code visualchars fullscreen image link media table charmap hr nonbreaking '
                        +'insertdatetime advlist lists wordcount textpattern noneditable help charmap '
                        +'quickbars emoticons',
                menubar: 'file edit view insert format tools help',// table
                toolbar: 'save | undo redo | bold italic underline strikethrough | fontselect | fontsizeselect '
                        +'| formatselect | alignleft aligncenter alignright alignjustify | outdent indent '
                        +'|  numlist bullist table | image media link | ltr rtl | forecolor backcolor removeformat '
                        +'| charmap emoticons | fullscreen code',//  preview print
                toolbar_sticky: true,
                autosave_ask_before_unload: true,
                autosave_interval: '30s',
                autosave_prefix: '{path}{query}-{id}-',
                autosave_restore_when_empty: false,
                autosave_retention: '2m',
                image_advtab: true,
                importcss_append: true,
                image_title: true,
                // enable automatic uploads of images represented by blob or data URIs
                automatic_uploads: true,
                images_upload_url: opts.doc_root + 'vendor/tinymce/tinymce/filemanager.php',
                images_reuse_filename: true,
                file_picker_types: 'image media',
                /// and here's our custom image picker
                file_picker_callback: function (cb, value, meta) {
                    let par = document.querySelector('#tinymce-filemanager');
                    let poper = document.querySelector('#tinymce-filemanager > div > div');
                    par.style.display = 'block';
                    document.getElementById('newmedia').addEventListener('click',function(){
                    var input = document.createElement('input');
                    input.setAttribute('type', 'file');
                    if(meta.filetype == 'image'){
                        input.setAttribute('accept', 'image/*');
                    }
                    else if(meta.filetype == 'media'){
                        input.setAttribute('accept', 'video/*');
                    }
            
                    
                    //    Note: In modern browsers input[type="file"] is functional without
                    //    even adding it to the DOM, but that might not be the case in some older
                    //    or quirky browsers like IE, so you might want to add it to the DOM
                    //    just in case, and visually hide it. And do not forget do remove it
                    //    once you do not need it anymore.
                    
            
                    input.onchange = function () {
                        var file = this.files[0];
            
                        var reader = new FileReader();
                        reader.onload = function () {
                        
                        //    Note: Now we need to register the blob in TinyMCEs image blob
                        //    registry. In the next release this part hopefully won't be
                        //    necessary, as we are looking to handle it internally.
                        
                        var id = 'blobid' + (new Date()).getTime();
                        var blobCache =  tinymce.activeEditor.editorUpload.blobCache;
                        var base64 = reader.result.split(',')[1];
                        var blobInfo = blobCache.create(id, file, base64);
                        blobCache.add(blobInfo);
            
                        // call the callback and populate the Title field with the file name *
                        cb(blobInfo.blobUri(), { title: file.name });
                        par.style.display = 'none';
                        poper.innerHTML = 'Loading...';
                        };
                        reader.readAsDataURL(file);
                    };
            
                    input.click();
                    });
                    datz = new FormData();
                    datz.append('ftype', meta.filetype);
                    ajax(
                    opts.doc_root+'vendor/tinymce/tinymce/filemanager.php',
                    res=>{
                        poper.innerHTML = res;
                        poper.addEventListener('click', evt=>{
                            if(evt.target.tagName == 'IMG'){
                                let src = ''+evt.target.getAttribute('src');
                                cb(src,{title:evt.target.getAttribute('title'),alt:evt.target.getAttribute('alt')});
                                par.style.display = 'none';
                                poper.innerHTML = 'Loading...';
                            }
                        });
                    },
                    error=>{
                        console.log(error);
                    },
                    datz
                    );
                },
                document_base_url: opts.doc_root,
                height: opts.height,
                image_caption: true,
                quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote quickimage quicktable',
                noneditable_noneditable_class: 'mceNonEditable',
                toolbar_mode: 'sliding',
                contextmenu: 'link image table',
                skin: useDarkMode ? 'oxide-dark' : 'oxide',
                content_css: useDarkMode ? 'dark' : 'default',
                content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:16px }.flex{display:flex}.flex>*{flex-basis:100%}img{max-width:100%;vertical-align:middle}'
            };
            tinymce.init(tinymce_opts);
        }
        
            /* Pagination */
            document.addEventListener('DOMContentLoaded', function () {
                const content = document.querySelector('.paginate'); 
                if(content !== null){
                    let ic = parseInt(content.getAttribute('data-items-per-page'));
                    const itemsPerPage = ic || 10;
                    let currentPage = 0;
                    const items = Array.from(content.getElementsByTagName('tr')).slice(1);
                    const tables = Array.from(content.getElementsByTagName('table'));

                    function showPage(page) {
                        const startIndex = page * itemsPerPage;
                        const endIndex = startIndex + itemsPerPage;
                        tables.forEach((table, tindex) => {
                            let tr = table.querySelector('tbody').children;
                            Array.from(tr).forEach((item, index)=>{
                                item.classList.toggle('hidden', index < startIndex || index >= endIndex);
                            });
                        });
                        updateActiveButtonStates();
                    }
                    function showPage(page) {
                        const startIndex = page * itemsPerPage;
                        const endIndex = startIndex + itemsPerPage;
                        items.forEach((item, index) => {
                            item.classList.toggle('hidden', index < startIndex || index >= endIndex);
                        });
                        updateActiveButtonStates();
                    }

                    function createPageButtons() {
                        const totalPages = Math.ceil(items.length / itemsPerPage);
                        if(totalPages < 2) return;
                        const paginationContainer = document.createElement('div');
                        const paginationDiv = document.body.appendChild(paginationContainer);
                        paginationContainer.classList.add('pagination');

                        // Add page buttons
                        for (let i = 0; i < totalPages; i++) {
                            const pageButton = document.createElement('button');
                            pageButton.textContent = i + 1;
                            pageButton.addEventListener('click', () => {
                                currentPage = i;
                                showPage(currentPage);
                                updateActiveButtonStates();
                            });

                            content.appendChild(paginationContainer);
                            paginationDiv.appendChild(pageButton);
                        }
                    }

                    function updateActiveButtonStates() {
                        const pageButtons = document.querySelectorAll('.pagination button');
                        pageButtons.forEach((button, index) => {
                            if (index === currentPage) {
                                button.classList.add('active');
                            } else {
                                button.classList.remove('active');
                            }
                        });
                    }

                    createPageButtons(); // create the page buttons initially
                    showPage(currentPage);
                }
            });
        
       </script>
    </body>
</html>